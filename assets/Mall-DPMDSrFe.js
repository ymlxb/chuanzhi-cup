import{H as $,u as D,r as p,a as x,B as H,b as i,o as m,c as g,d as u,g as l,f as s,F as J,l as O,e as k,k as v,I as G,h as E,E as f,J as K,p as P,i as Q,_ as W}from"./index-DGSYi3EO.js";import{u as X,b as Y,c as Z}from"./api-D7mIgXGH.js";const b=c=>(P("data-v-94535cdc"),c=c(),Q(),c),F={class:"contain"},ee=b(()=>u("aside",null,null,-1)),le={class:"wrap"},te=b(()=>u("div",{class:"head"},null,-1)),oe={class:"detail"},ae=b(()=>u("h1",{class:"title"},"发布物品",-1)),re={key:0,class:"custom-loading-overlay"},se=["src"],ne={class:"detail-footer",style:{display:"flex","justify-content":"end"}},ie=$({__name:"Mall",setup(c){const y=D(),I=X().userInfo.access_token,d=p(""),h=p(null),_=p(!0),t=x({name:"",price:"",description:"",tag:"",images:[],mobile:"",email:""}),M={name:[{required:!0,message:"请输入物品名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],price:[{required:!0,message:"请输入出售价格",trigger:"blur"},{type:"number",message:"价格必须是数字",trigger:"blur"}],tag:[{required:!0,message:"请输入物品名称",trigger:"blur"}],description:[{required:!0,message:"请输入物品名称",trigger:"blur"},{min:20,max:100,message:"长度在 20 到 100 个字符",trigger:"blur"}],mobile:[{required:!0,validator:(o,e,r)=>{e===""?r(new Error("请输入联系电话")):/^1[3|4|5|6|7|8|9][0-9]{9}$/.test(e)?r():r(new Error("请输入正确的联系电话"))},trigger:"blur"}],email:[{required:!0,validator:(o,e,r)=>{e===""?r(new Error("请输入邮箱地址")):/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(e)?r():r(new Error("请输入正确的邮箱地址"))},trigger:"blur"}],images:[{required:!0,message:"请上传物品照片",trigger:"blur"}]},S=p("");H(()=>{A()});const q=async()=>{h.value.validate(async o=>{if(o){const e=await Z(t);console.log(e),e.code===0?(f.success("发布成功"),S.value=e.data.id,y.push("/trade")):f.error("发布失败")}else return console.log("表单验证失败!"),!1})},C=()=>{y.push("/trade")},j=o=>(console.log("1111"),_.value=!0,o.type!=="image/jpeg"&&o.type!=="image/png"&&o.type!=="image/jfif"?(f.error("图片必须是jpg,png或jfif格式"),!1):o.size/1024/1024>2?(f.error("图片大小不能超过2MB"),!1):(console.log("444"),!0)),B=(o,e)=>{console.log("333444"),_.value=!1,d.value=URL.createObjectURL(e.raw),d.value=o.data,t.images.push(d.value),console.log("图片地址",d.value)};let V=x([]);const A=async()=>{await Y().then(o=>{V.value=o.data,console.log(o.data)})};return(o,e)=>{const r=i("el-input"),n=i("el-form-item"),L=i("el-option"),R=i("el-select"),w=i("el-icon"),N=i("el-upload"),U=i("el-button"),T=i("el-form");return m(),g("div",F,[ee,u("main",null,[u("div",le,[te,u("div",oe,[ae,l(T,{model:t,"label-width":"auto",style:{"max-width":"60rem",margin:"auto"},rules:M,ref_key:"formRef",ref:h},{default:s(()=>[l(n,{label:"物品名称:",prop:"name"},{default:s(()=>[l(r,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),placeholder:"请输入物品名称(长度在 3 到 20 个字符)"},null,8,["modelValue"])]),_:1}),l(n,{label:"出售价格:",prop:"price"},{default:s(()=>[l(r,{modelValue:t.price,"onUpdate:modelValue":e[1]||(e[1]=a=>t.price=a),modelModifiers:{number:!0},placeholder:"请输入出售价格"},null,8,["modelValue"])]),_:1}),l(n,{label:"物品类型:",prop:"tag"},{default:s(()=>[l(R,{modelValue:t.tag,"onUpdate:modelValue":e[2]||(e[2]=a=>t.tag=a),placeholder:"请输入商品类型"},{default:s(()=>[(m(!0),g(J,null,O(v(V).value,(a,z)=>(m(),k(L,{key:z,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"物品描述:",prop:"description"},{default:s(()=>[l(r,{modelValue:t.description,"onUpdate:modelValue":e[3]||(e[3]=a=>t.description=a),type:"textarea",placeholder:"请输入物品描述(长度在 20 到 100 个字符)"},null,8,["modelValue"])]),_:1}),l(n,{label:"联系电话:",prop:"mobile"},{default:s(()=>[l(r,{modelValue:t.mobile,"onUpdate:modelValue":e[4]||(e[4]=a=>t.mobile=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(n,{label:"邮箱地址:",prop:"email"},{default:s(()=>[l(r,{modelValue:t.email,"onUpdate:modelValue":e[5]||(e[5]=a=>t.email=a),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),l(n,{label:"物品照片:",prop:"images"},{default:s(()=>[l(N,{class:"avatar-uploader",action:"http://10.102.73.64:8081/mall/Commodity/insertImage",headers:{Authorization:v(I)},"show-file-list":!1,"on-success":B,"before-upload":j},{default:s(()=>[_.value?(m(),g("div",re,[l(w,{type:"loading",class:"custom-loading-icon"})])):G("",!0),d.value?(m(),g("img",{key:1,src:d.value,class:"avatar"},null,8,se)):(m(),k(w,{key:2,class:"avatar-uploader-icon"},{default:s(()=>[l(v(K))]),_:1}))]),_:1},8,["headers"])]),_:1}),u("div",ne,[l(U,{type:"primary",round:"",onClick:C,style:{"margin-left":"3rem"}},{default:s(()=>[E("取消")]),_:1}),l(U,{type:"primary",round:"",onClick:q,style:{"margin-left":"3rem"}},{default:s(()=>[E("保存")]),_:1})])]),_:1},8,["model"])])])])])}}}),ge=W(ie,[["__scopeId","data-v-94535cdc"]]);export{ge as default};
